/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={6489:(e,t)=>{t.parse=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var n={},o=t||{},i=e.split(";"),s=o.decode||r,c=0;c<i.length;c++){var d=i[c],u=d.indexOf("=");if(!(u<0)){var l=d.substring(0,u).trim();if(null==n[l]){var p=d.substring(u+1,d.length).trim();'"'===p[0]&&(p=p.slice(1,-1)),n[l]=a(p,s)}}}return n},t.serialize=function(e,t,r){var a=r||{},i=a.encode||n;if("function"!=typeof i)throw new TypeError("option encode is invalid");if(!o.test(e))throw new TypeError("argument name is invalid");var s=i(t);if(s&&!o.test(s))throw new TypeError("argument val is invalid");var c=e+"="+s;if(null!=a.maxAge){var d=a.maxAge-0;if(isNaN(d)||!isFinite(d))throw new TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(d)}if(a.domain){if(!o.test(a.domain))throw new TypeError("option domain is invalid");c+="; Domain="+a.domain}if(a.path){if(!o.test(a.path))throw new TypeError("option path is invalid");c+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+a.expires.toUTCString()}a.httpOnly&&(c+="; HttpOnly");a.secure&&(c+="; Secure");if(a.sameSite){switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;case"none":c+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return c};var r=decodeURIComponent,n=encodeURIComponent,o=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function a(e,t){try{return t(e)}catch(t){return e}}},763:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});const n='<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"/> <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"/> <title>Authorization@Edge</title> <style>html{padding:0}body{display:flex;min-height:100%;margin:0;justify-content:center;align-items:flex-start}.message-card{flex-grow:1;max-width:600px;margin-top:2%}</style> </head> <body> <div class="card message-card"> <h5 class="card-header">Authorization@Edge</h5> <div class="card-body"> <h5 class="card-title">${title}</h5> <p> ${message} <a class="card-link" data-toggle="collapse" href="#details" role="button" aria-expanded="false" aria-controls="details"> ${expandText} </a> </p> <p class="collapse blockquote-footer" id="details"> ${details} [log region: ${region}] </p> <a href="${linkUri}" class="btn btn-primary" role="button">${linkText}</a> </div> </div> <script src="https://code.jquery.com/jquery-3.5.0.slim.min.js" integrity="sha384-/IFzzQmt1S744I+IQO4Mc1uphkxbXt1tEwjQ/qSw2p8pXWck09sLvqHmKDYYwReJ" crossorigin="anonymous"><\/script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"><\/script> </body> </html> '},9978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cryptoRuntime=t.base64url=t.generateSecret=t.generateKeyPair=t.errors=t.decodeJwt=t.decodeProtectedHeader=t.importJWK=t.importX509=t.importPKCS8=t.importSPKI=t.exportJWK=t.exportSPKI=t.exportPKCS8=t.UnsecuredJWT=t.createRemoteJWKSet=t.createLocalJWKSet=t.EmbeddedJWK=t.calculateJwkThumbprintUri=t.calculateJwkThumbprint=t.EncryptJWT=t.SignJWT=t.GeneralSign=t.FlattenedSign=t.CompactSign=t.FlattenedEncrypt=t.CompactEncrypt=t.jwtDecrypt=t.jwtVerify=t.generalVerify=t.flattenedVerify=t.compactVerify=t.GeneralEncrypt=t.generalDecrypt=t.flattenedDecrypt=t.compactDecrypt=void 0;var n=r(8739);Object.defineProperty(t,"compactDecrypt",{enumerable:!0,get:function(){return n.compactDecrypt}});var o=r(2590);Object.defineProperty(t,"flattenedDecrypt",{enumerable:!0,get:function(){return o.flattenedDecrypt}});var a=r(949);Object.defineProperty(t,"generalDecrypt",{enumerable:!0,get:function(){return a.generalDecrypt}});var i=r(920);Object.defineProperty(t,"GeneralEncrypt",{enumerable:!0,get:function(){return i.GeneralEncrypt}});var s=r(6313);Object.defineProperty(t,"compactVerify",{enumerable:!0,get:function(){return s.compactVerify}});var c=r(3681);Object.defineProperty(t,"flattenedVerify",{enumerable:!0,get:function(){return c.flattenedVerify}});var d=r(9864);Object.defineProperty(t,"generalVerify",{enumerable:!0,get:function(){return d.generalVerify}});var u=r(8782);Object.defineProperty(t,"jwtVerify",{enumerable:!0,get:function(){return u.jwtVerify}});var l=r(430);Object.defineProperty(t,"jwtDecrypt",{enumerable:!0,get:function(){return l.jwtDecrypt}});var p=r(5712);Object.defineProperty(t,"CompactEncrypt",{enumerable:!0,get:function(){return p.CompactEncrypt}});var f=r(7736);Object.defineProperty(t,"FlattenedEncrypt",{enumerable:!0,get:function(){return f.FlattenedEncrypt}});var h=r(3390);Object.defineProperty(t,"CompactSign",{enumerable:!0,get:function(){return h.CompactSign}});var y=r(4111);Object.defineProperty(t,"FlattenedSign",{enumerable:!0,get:function(){return y.FlattenedSign}});var g=r(1737);Object.defineProperty(t,"GeneralSign",{enumerable:!0,get:function(){return g.GeneralSign}});var w=r(8081);Object.defineProperty(t,"SignJWT",{enumerable:!0,get:function(){return w.SignJWT}});var m=r(179);Object.defineProperty(t,"EncryptJWT",{enumerable:!0,get:function(){return m.EncryptJWT}});var v=r(5948);Object.defineProperty(t,"calculateJwkThumbprint",{enumerable:!0,get:function(){return v.calculateJwkThumbprint}}),Object.defineProperty(t,"calculateJwkThumbprintUri",{enumerable:!0,get:function(){return v.calculateJwkThumbprintUri}});var S=r(3089);Object.defineProperty(t,"EmbeddedJWK",{enumerable:!0,get:function(){return S.EmbeddedJWK}});var E=r(8577);Object.defineProperty(t,"createLocalJWKSet",{enumerable:!0,get:function(){return E.createLocalJWKSet}});var b=r(9753);Object.defineProperty(t,"createRemoteJWKSet",{enumerable:!0,get:function(){return b.createRemoteJWKSet}});var _=r(9833);Object.defineProperty(t,"UnsecuredJWT",{enumerable:!0,get:function(){return _.UnsecuredJWT}});var P=r(8784);Object.defineProperty(t,"exportPKCS8",{enumerable:!0,get:function(){return P.exportPKCS8}}),Object.defineProperty(t,"exportSPKI",{enumerable:!0,get:function(){return P.exportSPKI}}),Object.defineProperty(t,"exportJWK",{enumerable:!0,get:function(){return P.exportJWK}});var J=r(6484);Object.defineProperty(t,"importSPKI",{enumerable:!0,get:function(){return J.importSPKI}}),Object.defineProperty(t,"importPKCS8",{enumerable:!0,get:function(){return J.importPKCS8}}),Object.defineProperty(t,"importX509",{enumerable:!0,get:function(){return J.importX509}}),Object.defineProperty(t,"importJWK",{enumerable:!0,get:function(){return J.importJWK}});var k=r(2945);Object.defineProperty(t,"decodeProtectedHeader",{enumerable:!0,get:function(){return k.decodeProtectedHeader}});var W=r(7084);Object.defineProperty(t,"decodeJwt",{enumerable:!0,get:function(){return W.decodeJwt}}),t.errors=r(4103);var A=r(9980);Object.defineProperty(t,"generateKeyPair",{enumerable:!0,get:function(){return A.generateKeyPair}});var K=r(6874);Object.defineProperty(t,"generateSecret",{enumerable:!0,get:function(){return K.generateSecret}}),t.base64url=r(9989);var O=r(9059);Object.defineProperty(t,"cryptoRuntime",{enumerable:!0,get:function(){return O.default}})},8739:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compactDecrypt=void 0;const n=r(2590),o=r(4103),a=r(405);t.compactDecrypt=async function(e,t,r){if(e instanceof Uint8Array&&(e=a.decoder.decode(e)),"string"!=typeof e)throw new o.JWEInvalid("Compact JWE must be a string or Uint8Array");const{0:i,1:s,2:c,3:d,4:u,length:l}=e.split(".");if(5!==l)throw new o.JWEInvalid("Invalid Compact JWE");const p=await(0,n.flattenedDecrypt)({ciphertext:d,iv:c||void 0,protected:i||void 0,tag:u||void 0,encrypted_key:s||void 0},t,r),f={plaintext:p.plaintext,protectedHeader:p.protectedHeader};return"function"==typeof t?{...f,key:p.key}:f}},5712:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompactEncrypt=void 0;const n=r(7736);t.CompactEncrypt=class{constructor(e){this._flattened=new n.FlattenedEncrypt(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){const r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}},2590:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flattenedDecrypt=void 0;const n=r(9449),o=r(3963),a=r(7247),i=r(4103),s=r(2680),c=r(1328),d=r(3686),u=r(405),l=r(5559),p=r(2042),f=r(3679);t.flattenedDecrypt=async function(e,t,r){var h;if(!(0,c.default)(e))throw new i.JWEInvalid("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new i.JWEInvalid("JOSE Header missing");if("string"!=typeof e.iv)throw new i.JWEInvalid("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new i.JWEInvalid("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new i.JWEInvalid("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new i.JWEInvalid("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new i.JWEInvalid("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new i.JWEInvalid("JWE AAD incorrect type");if(void 0!==e.header&&!(0,c.default)(e.header))throw new i.JWEInvalid("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!(0,c.default)(e.unprotected))throw new i.JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");let y;if(e.protected)try{const t=(0,n.decode)(e.protected);y=JSON.parse(u.decoder.decode(t))}catch{throw new i.JWEInvalid("JWE Protected Header is invalid")}if(!(0,s.default)(y,e.header,e.unprotected))throw new i.JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const g={...y,...e.header,...e.unprotected};if((0,p.default)(i.JWEInvalid,new Map,null==r?void 0:r.crit,y,g),void 0!==g.zip){if(!y||!y.zip)throw new i.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==g.zip)throw new i.JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:w,enc:m}=g;if("string"!=typeof w||!w)throw new i.JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof m||!m)throw new i.JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");const v=r&&(0,f.default)("keyManagementAlgorithms",r.keyManagementAlgorithms),S=r&&(0,f.default)("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(v&&!v.has(w))throw new i.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(S&&!S.has(m))throw new i.JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter not allowed');let E;if(void 0!==e.encrypted_key)try{E=(0,n.decode)(e.encrypted_key)}catch{throw new i.JWEInvalid("Failed to base64url decode the encrypted_key")}let b,_,P,J=!1;"function"==typeof t&&(t=await t(y,e),J=!0);try{b=await(0,d.default)(w,t,E,g,r)}catch(e){if(e instanceof TypeError||e instanceof i.JWEInvalid||e instanceof i.JOSENotSupported)throw e;b=(0,l.default)(m)}try{_=(0,n.decode)(e.iv)}catch{throw new i.JWEInvalid("Failed to base64url decode the iv")}try{P=(0,n.decode)(e.tag)}catch{throw new i.JWEInvalid("Failed to base64url decode the tag")}const k=u.encoder.encode(null!==(h=e.protected)&&void 0!==h?h:"");let W,A;W=void 0!==e.aad?(0,u.concat)(k,u.encoder.encode("."),u.encoder.encode(e.aad)):k;try{A=(0,n.decode)(e.ciphertext)}catch{throw new i.JWEInvalid("Failed to base64url decode the ciphertext")}let K=await(0,o.default)(m,b,A,_,P,W);"DEF"===g.zip&&(K=await((null==r?void 0:r.inflateRaw)||a.inflate)(K));const O={plaintext:K};if(void 0!==e.protected&&(O.protectedHeader=y),void 0!==e.aad)try{O.additionalAuthenticatedData=(0,n.decode)(e.aad)}catch{throw new i.JWEInvalid("Failed to base64url decode the aad")}return void 0!==e.unprotected&&(O.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(O.unprotectedHeader=e.header),J?{...O,key:t}:O}},7736:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlattenedEncrypt=t.unprotected=void 0;const n=r(9449),o=r(7877),a=r(7247),i=r(4293),s=r(9236),c=r(4103),d=r(2680),u=r(405),l=r(2042);t.unprotected=Symbol();t.FlattenedEncrypt=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,r){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new c.JWEInvalid("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!(0,d.default)(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new c.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const p={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if((0,l.default)(c.JWEInvalid,new Map,null==r?void 0:r.crit,this._protectedHeader,p),void 0!==p.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new c.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==p.zip)throw new c.JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:f,enc:h}=p;if("string"!=typeof f||!f)throw new c.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof h||!h)throw new c.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let y,g,w,m,v,S,E;if("dir"===f){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===f&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let n;({cek:g,encryptedKey:y,parameters:n}=await(0,s.default)(f,h,e,this._cek,this._keyManagementParameters)),n&&(r&&t.unprotected in r?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...n}:this.setUnprotectedHeader(n):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...n}:this.setProtectedHeader(n))}if(this._iv||(this._iv=(0,i.default)(h)),m=this._protectedHeader?u.encoder.encode((0,n.encode)(JSON.stringify(this._protectedHeader))):u.encoder.encode(""),this._aad?(v=(0,n.encode)(this._aad),w=(0,u.concat)(m,u.encoder.encode("."),u.encoder.encode(v))):w=m,"DEF"===p.zip){const e=await((null==r?void 0:r.deflateRaw)||a.deflate)(this._plaintext);({ciphertext:S,tag:E}=await(0,o.default)(h,e,g,this._iv,w))}else({ciphertext:S,tag:E}=await(0,o.default)(h,this._plaintext,g,this._iv,w));const b={ciphertext:(0,n.encode)(S),iv:(0,n.encode)(this._iv),tag:(0,n.encode)(E)};return y&&(b.encrypted_key=(0,n.encode)(y)),v&&(b.aad=v),this._protectedHeader&&(b.protected=u.decoder.decode(m)),this._sharedUnprotectedHeader&&(b.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(b.header=this._unprotectedHeader),b}}},949:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generalDecrypt=void 0;const n=r(2590),o=r(4103),a=r(1328);t.generalDecrypt=async function(e,t,r){if(!(0,a.default)(e))throw new o.JWEInvalid("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(a.default))throw new o.JWEInvalid("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new o.JWEInvalid("JWE Recipients has no members");for(const o of e.recipients)try{return await(0,n.flattenedDecrypt)({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:o.encrypted_key,header:o.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new o.JWEDecryptionFailed}},920:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeneralEncrypt=void 0;const n=r(7736),o=r(4103),a=r(5559),i=r(2680),s=r(9236),c=r(9449),d=r(2042);class u{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}t.GeneralEncrypt=class{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){const r=new u(this,e,{crit:null==t?void 0:t.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(e){var t,r,u;if(!this._recipients.length)throw new o.JWEInvalid("at least one recipient must be added");if(e={deflateRaw:null==e?void 0:e.deflateRaw},1===this._recipients.length){const[t]=this._recipients,r=await new n.FlattenedEncrypt(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(t.unprotectedHeader).encrypt(t.key,{...t.options,...e});let o={ciphertext:r.ciphertext,iv:r.iv,recipients:[{}],tag:r.tag};return r.aad&&(o.aad=r.aad),r.protected&&(o.protected=r.protected),r.unprotected&&(o.unprotected=r.unprotected),r.encrypted_key&&(o.recipients[0].encrypted_key=r.encrypted_key),r.header&&(o.recipients[0].header=r.header),o}let l;for(let e=0;e<this._recipients.length;e++){const t=this._recipients[e];if(!(0,i.default)(this._protectedHeader,this._unprotectedHeader,t.unprotectedHeader))throw new o.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader,...t.unprotectedHeader},{alg:n}=r;if("string"!=typeof n||!n)throw new o.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===n||"ECDH-ES"===n)throw new o.JWEInvalid('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof r.enc||!r.enc)throw new o.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(l){if(l!==r.enc)throw new o.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else l=r.enc;if((0,d.default)(o.JWEInvalid,new Map,t.options.crit,this._protectedHeader,r),!(void 0===r.zip||this._protectedHeader&&this._protectedHeader.zip))throw new o.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}const p=(0,a.default)(l);let f={ciphertext:"",iv:"",recipients:[],tag:""};for(let o=0;o<this._recipients.length;o++){const a=this._recipients[o],i={};f.recipients.push(i);const d={...this._protectedHeader,...this._unprotectedHeader,...a.unprotectedHeader}.alg.startsWith("PBES2")?2048+o:void 0;if(0===o){const t=await new n.FlattenedEncrypt(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(p).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(a.unprotectedHeader).setKeyManagementParameters({p2c:d}).encrypt(a.key,{...a.options,...e,[n.unprotected]:!0});f.ciphertext=t.ciphertext,f.iv=t.iv,f.tag=t.tag,t.aad&&(f.aad=t.aad),t.protected&&(f.protected=t.protected),t.unprotected&&(f.unprotected=t.unprotected),i.encrypted_key=t.encrypted_key,t.header&&(i.header=t.header);continue}const{encryptedKey:h,parameters:y}=await(0,s.default)((null===(t=a.unprotectedHeader)||void 0===t?void 0:t.alg)||(null===(r=this._protectedHeader)||void 0===r?void 0:r.alg)||(null===(u=this._unprotectedHeader)||void 0===u?void 0:u.alg),l,a.key,p,{p2c:d});i.encrypted_key=(0,c.encode)(h),(a.unprotectedHeader||y)&&(i.header={...a.unprotectedHeader,...y})}return f}}},3089:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmbeddedJWK=void 0;const n=r(6484),o=r(1328),a=r(4103);t.EmbeddedJWK=async function(e,t){const r={...e,...null==t?void 0:t.header};if(!(0,o.default)(r.jwk))throw new a.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a JSON object');const i=await(0,n.importJWK)({...r.jwk,ext:!0},r.alg,!0);if(i instanceof Uint8Array||"public"!==i.type)throw new a.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a public key');return i}},5948:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateJwkThumbprintUri=t.calculateJwkThumbprint=void 0;const n=r(1100),o=r(9449),a=r(4103),i=r(405),s=r(1328),c=(e,t)=>{if("string"!=typeof e||!e)throw new a.JWKInvalid(`${t} missing or invalid`)};async function d(e,t){if(!(0,s.default)(e))throw new TypeError("JWK must be an object");if(null!=t||(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(e.kty){case"EC":c(e.crv,'"crv" (Curve) Parameter'),c(e.x,'"x" (X Coordinate) Parameter'),c(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":c(e.crv,'"crv" (Subtype of Key Pair) Parameter'),c(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":c(e.e,'"e" (Exponent) Parameter'),c(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":c(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new a.JOSENotSupported('"kty" (Key Type) Parameter missing or unsupported')}const d=i.encoder.encode(JSON.stringify(r));return(0,o.encode)(await(0,n.default)(t,d))}t.calculateJwkThumbprint=d,t.calculateJwkThumbprintUri=async function(e,t){null!=t||(t="sha256");const r=await d(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}},8577:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLocalJWKSet=t.LocalJWKSet=t.isJWKSLike=void 0;const n=r(6484),o=r(4103),a=r(1328);function i(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(s)}function s(e){return(0,a.default)(e)}t.isJWKSLike=i;class c{constructor(e){if(this._cached=new WeakMap,!i(e))throw new o.JWKSInvalid("JSON Web Key Set malformed");var t;this._jwks=(t=e,"function"==typeof structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t)))}async getKey(e,t){const{alg:r,kid:n}={...e,...null==t?void 0:t.header},a=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new o.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this._jwks.keys.filter((e=>{let t=a===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t})),{0:s,length:c}=i;if(0===c)throw new o.JWKSNoMatchingKey;if(1!==c){const e=new o.JWKSMultipleMatchingKeys,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(const e of i)try{yield await d(t,e,r)}catch{continue}},e}return d(this._cached,s,r)}}async function d(e,t,r){const a=e.get(t)||e.set(t,{}).get(t);if(void 0===a[r]){const e=await(0,n.importJWK)({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new o.JWKSInvalid("JSON Web Key Set members must be public keys");a[r]=e}return a[r]}t.LocalJWKSet=c,t.createLocalJWKSet=function(e){const t=new c(e);return async function(e,r){return t.getKey(e,r)}}},9753:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRemoteJWKSet=void 0;const n=r(1313),o=r(4103),a=r(8577);class i extends a.LocalJWKSet{constructor(e,t){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent,headers:null==t?void 0:t.headers},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(e,t)}catch(r){if(r instanceof o.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),super.getKey(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=(0,n.default)(this._url,this._timeoutDuration,this._options).then((e=>{if(!(0,a.isJWKSLike)(e))throw new o.JWKSInvalid("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0})).catch((e=>{throw this._pendingFetch=void 0,e}))),await this._pendingFetch}}t.createRemoteJWKSet=function(e,t){const r=new i(e,t);return async function(e,t){return r.getKey(e,t)}}},3390:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompactSign=void 0;const n=r(4111);t.CompactSign=class{constructor(e){this._flattened=new n.FlattenedSign(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const r=await this._flattened.sign(e,t);if(void 0===r.payload)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}},6313:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compactVerify=void 0;const n=r(3681),o=r(4103),a=r(405);t.compactVerify=async function(e,t,r){if(e instanceof Uint8Array&&(e=a.decoder.decode(e)),"string"!=typeof e)throw new o.JWSInvalid("Compact JWS must be a string or Uint8Array");const{0:i,1:s,2:c,length:d}=e.split(".");if(3!==d)throw new o.JWSInvalid("Invalid Compact JWS");const u=await(0,n.flattenedVerify)({payload:s,protected:i,signature:c},t,r),l={payload:u.payload,protectedHeader:u.protectedHeader};return"function"==typeof t?{...l,key:u.key}:l}},4111:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FlattenedSign=void 0;const n=r(9449),o=r(164),a=r(2680),i=r(4103),s=r(405),c=r(8790),d=r(2042);t.FlattenedSign=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new i.JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,a.default)(this._protectedHeader,this._unprotectedHeader))throw new i.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader};let u=!0;if((0,d.default)(i.JWSInvalid,new Map([["b64",!0]]),null==t?void 0:t.crit,this._protectedHeader,r).has("b64")&&(u=this._protectedHeader.b64,"boolean"!=typeof u))throw new i.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:l}=r;if("string"!=typeof l||!l)throw new i.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,c.default)(l,e,"sign");let p,f=this._payload;u&&(f=s.encoder.encode((0,n.encode)(f))),p=this._protectedHeader?s.encoder.encode((0,n.encode)(JSON.stringify(this._protectedHeader))):s.encoder.encode("");const h=(0,s.concat)(p,s.encoder.encode("."),f),y=await(0,o.default)(l,e,h),g={signature:(0,n.encode)(y),payload:""};return u&&(g.payload=s.decoder.decode(f)),this._unprotectedHeader&&(g.header=this._unprotectedHeader),this._protectedHeader&&(g.protected=s.decoder.decode(p)),g}}},3681:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flattenedVerify=void 0;const n=r(9449),o=r(5723),a=r(4103),i=r(405),s=r(2680),c=r(1328),d=r(8790),u=r(2042),l=r(3679);t.flattenedVerify=async function(e,t,r){var p;if(!(0,c.default)(e))throw new a.JWSInvalid("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new a.JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new a.JWSInvalid("JWS Protected Header incorrect type");if(void 0===e.payload)throw new a.JWSInvalid("JWS Payload missing");if("string"!=typeof e.signature)throw new a.JWSInvalid("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,c.default)(e.header))throw new a.JWSInvalid("JWS Unprotected Header incorrect type");let f={};if(e.protected)try{const t=(0,n.decode)(e.protected);f=JSON.parse(i.decoder.decode(t))}catch{throw new a.JWSInvalid("JWS Protected Header is invalid")}if(!(0,s.default)(f,e.header))throw new a.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const h={...f,...e.header};let y=!0;if((0,u.default)(a.JWSInvalid,new Map([["b64",!0]]),null==r?void 0:r.crit,f,h).has("b64")&&(y=f.b64,"boolean"!=typeof y))throw new a.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:g}=h;if("string"!=typeof g||!g)throw new a.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');const w=r&&(0,l.default)("algorithms",r.algorithms);if(w&&!w.has(g))throw new a.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(y){if("string"!=typeof e.payload)throw new a.JWSInvalid("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new a.JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let m=!1;"function"==typeof t&&(t=await t(f,e),m=!0),(0,d.default)(g,t,"verify");const v=(0,i.concat)(i.encoder.encode(null!==(p=e.protected)&&void 0!==p?p:""),i.encoder.encode("."),"string"==typeof e.payload?i.encoder.encode(e.payload):e.payload);let S,E;try{S=(0,n.decode)(e.signature)}catch{throw new a.JWSInvalid("Failed to base64url decode the signature")}if(!await(0,o.default)(g,t,S,v))throw new a.JWSSignatureVerificationFailed;if(y)try{E=(0,n.decode)(e.payload)}catch{throw new a.JWSInvalid("Failed to base64url decode the payload")}else E="string"==typeof e.payload?i.encoder.encode(e.payload):e.payload;const b={payload:E};return void 0!==e.protected&&(b.protectedHeader=f),void 0!==e.header&&(b.unprotectedHeader=e.header),m?{...b,key:t}:b}},1737:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeneralSign=void 0;const n=r(4111),o=r(4103);class a{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}t.GeneralSign=class{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){const r=new a(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new o.JWSInvalid("at least one signature must be added");const e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){const r=this._signatures[t],a=new n.FlattenedSign(this._payload);a.setProtectedHeader(r.protectedHeader),a.setUnprotectedHeader(r.unprotectedHeader);const{payload:i,...s}=await a.sign(r.key,r.options);if(0===t)e.payload=i;else if(e.payload!==i)throw new o.JWSInvalid("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}},9864:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generalVerify=void 0;const n=r(3681),o=r(4103),a=r(1328);t.generalVerify=async function(e,t,r){if(!(0,a.default)(e))throw new o.JWSInvalid("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(a.default))throw new o.JWSInvalid("JWS Signatures missing or incorrect type");for(const o of e.signatures)try{return await(0,n.flattenedVerify)({header:o.header,payload:e.payload,protected:o.protected,signature:o.signature},t,r)}catch{}throw new o.JWSSignatureVerificationFailed}},430:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtDecrypt=void 0;const n=r(8739),o=r(5572),a=r(4103);t.jwtDecrypt=async function(e,t,r){const i=await(0,n.compactDecrypt)(e,t,r),s=(0,o.default)(i.protectedHeader,i.plaintext,r),{protectedHeader:c}=i;if(void 0!==c.iss&&c.iss!==s.iss)throw new a.JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==c.sub&&c.sub!==s.sub)throw new a.JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==c.aud&&JSON.stringify(c.aud)!==JSON.stringify(s.aud))throw new a.JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch',"aud","mismatch");const d={payload:s,protectedHeader:c};return"function"==typeof t?{...d,key:i.key}:d}},179:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptJWT=void 0;const n=r(5712),o=r(405),a=r(4900);class i extends a.ProduceJWT{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){const r=new n.CompactEncrypt(o.encoder.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}t.EncryptJWT=i},4900:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProduceJWT=void 0;const n=r(7874),o=r(1328),a=r(9086);t.ProduceJWT=class{constructor(e){if(!(0,o.default)(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return this._payload="number"==typeof e?{...this._payload,nbf:e}:{...this._payload,nbf:(0,n.default)(new Date)+(0,a.default)(e)},this}setExpirationTime(e){return this._payload="number"==typeof e?{...this._payload,exp:e}:{...this._payload,exp:(0,n.default)(new Date)+(0,a.default)(e)},this}setIssuedAt(e){return this._payload=void 0===e?{...this._payload,iat:(0,n.default)(new Date)}:{...this._payload,iat:e},this}}},8081:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SignJWT=void 0;const n=r(3390),o=r(4103),a=r(405),i=r(4900);class s extends i.ProduceJWT{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;const i=new n.CompactSign(a.encoder.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray(null===(r=this._protectedHeader)||void 0===r?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new o.JWTInvalid("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}t.SignJWT=s},9833:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnsecuredJWT=void 0;const n=r(9449),o=r(405),a=r(4103),i=r(5572),s=r(4900);class c extends s.ProduceJWT{encode(){return`${n.encode(JSON.stringify({alg:"none"}))}.${n.encode(JSON.stringify(this._payload))}.`}static decode(e,t){if("string"!=typeof e)throw new a.JWTInvalid("Unsecured JWT must be a string");const{0:r,1:s,2:c,length:d}=e.split(".");if(3!==d||""!==c)throw new a.JWTInvalid("Invalid Unsecured JWT");let u;try{if(u=JSON.parse(o.decoder.decode(n.decode(r))),"none"!==u.alg)throw new Error}catch{throw new a.JWTInvalid("Invalid Unsecured JWT")}return{payload:(0,i.default)(u,n.decode(s),t),header:u}}}t.UnsecuredJWT=c},8782:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwtVerify=void 0;const n=r(6313),o=r(5572),a=r(4103);t.jwtVerify=async function(e,t,r){var i;const s=await(0,n.compactVerify)(e,t,r);if((null===(i=s.protectedHeader.crit)||void 0===i?void 0:i.includes("b64"))&&!1===s.protectedHeader.b64)throw new a.JWTInvalid("JWTs MUST NOT use unencoded payload");const c={payload:(0,o.default)(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return"function"==typeof t?{...c,key:s.key}:c}},8784:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exportJWK=t.exportPKCS8=t.exportSPKI=void 0;const n=r(970),o=r(970),a=r(448);t.exportSPKI=async function(e){return(0,n.toSPKI)(e)},t.exportPKCS8=async function(e){return(0,o.toPKCS8)(e)},t.exportJWK=async function(e){return(0,a.default)(e)}},9980:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateKeyPair=void 0;const n=r(3114);t.generateKeyPair=async function(e,t){return(0,n.generateKeyPair)(e,t)}},6874:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateSecret=void 0;const n=r(3114);t.generateSecret=async function(e,t){return(0,n.generateSecret)(e,t)}},6484:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.importJWK=t.importPKCS8=t.importX509=t.importSPKI=void 0;const n=r(9449),o=r(970),a=r(1522),i=r(4103),s=r(1328);t.importSPKI=async function(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw new TypeError('"spki" must be SPKI formatted string');return(0,o.fromSPKI)(e,t,r)},t.importX509=async function(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw new TypeError('"x509" must be X.509 formatted string');return(0,o.fromX509)(e,t,r)},t.importPKCS8=async function(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return(0,o.fromPKCS8)(e,t,r)},t.importJWK=async function(e,t,r){var o;if(!(0,s.default)(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return null!=r||(r=!0!==e.ext),r?(0,a.default)({...e,alg:t,ext:null!==(o=e.ext)&&void 0!==o&&o}):(0,n.decode)(e.k);case"RSA":if(void 0!==e.oth)throw new i.JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return(0,a.default)({...e,alg:t});default:throw new i.JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}},534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=t.wrap=void 0;const n=r(7877),o=r(3963),a=r(4293),i=r(9449);t.wrap=async function(e,t,r,o){const s=e.slice(0,7);o||(o=(0,a.default)(s));const{ciphertext:c,tag:d}=await(0,n.default)(s,r,t,o,new Uint8Array(0));return{encryptedKey:c,iv:(0,i.encode)(o),tag:(0,i.encode)(d)}},t.unwrap=async function(e,t,r,n,a){const i=e.slice(0,7);return(0,o.default)(i,t,r,n,a,new Uint8Array(0))}},405:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.concatKdf=t.lengthAndInput=t.uint32be=t.uint64be=t.p2s=t.concat=t.decoder=t.encoder=void 0;const n=r(1100);t.encoder=new TextEncoder,t.decoder=new TextDecoder;const o=2**32;function a(...e){const t=e.reduce(((e,{length:t})=>e+t),0),r=new Uint8Array(t);let n=0;return e.forEach((e=>{r.set(e,n),n+=e.length})),r}function i(e,t,r){if(t<0||t>=o)throw new RangeError(`value must be >= 0 and <= ${o-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function s(e){const t=new Uint8Array(4);return i(t,e),t}t.concat=a,t.p2s=function(e,r){return a(t.encoder.encode(e),new Uint8Array([0]),r)},t.uint64be=function(e){const t=Math.floor(e/o),r=e%o,n=new Uint8Array(8);return i(n,t,0),i(n,r,4),n},t.uint32be=s,t.lengthAndInput=function(e){return a(s(e.length),e)},t.concatKdf=async function(e,t,r){const o=Math.ceil((t>>3)/32),a=new Uint8Array(32*o);for(let t=0;t<o;t++){const o=new Uint8Array(4+e.length+r.length);o.set(s(t+1)),o.set(e,4),o.set(r,4+e.length),a.set(await(0,n.default)("sha256",o),32*t)}return a.slice(0,t>>3)}},5559:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bitLength=void 0;const n=r(4103),o=r(1929);function a(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new n.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}t.bitLength=a,t.default=e=>(0,o.default)(new Uint8Array(a(e)>>3))},5202:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103),o=r(4293);t.default=(e,t)=>{if(t.length<<3!==(0,o.bitLength)(e))throw new n.JWEInvalid("Invalid Initialization Vector length")}},8790:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(1432),o=r(1766);t.default=(e,t,r)=>{e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?((e,t)=>{if(!(t instanceof Uint8Array)){if(!(0,o.default)(t))throw new TypeError((0,n.withAlg)(e,t,...o.types,"Uint8Array"));if("secret"!==t.type)throw new TypeError(`${o.types.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}})(e,t):((e,t,r)=>{if(!(0,o.default)(t))throw new TypeError((0,n.withAlg)(e,t,...o.types));if("secret"===t.type)throw new TypeError(`${o.types.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw new TypeError(`${o.types.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw new TypeError(`${o.types.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw new TypeError(`${o.types.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw new TypeError(`${o.types.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)})(e,t,r)}},7990:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103);t.default=function(e){if(!(e instanceof Uint8Array)||e.length<8)throw new n.JWEInvalid("PBES2 Salt Input must be 8 or more octets")}},195:(e,t)=>{function r(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function n(e,t){return e.name===t}function o(e){return parseInt(e.name.slice(4),10)}function a(e,t){if(t.length&&!t.some((t=>e.usages.includes(t)))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw new TypeError(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkEncCryptoKey=t.checkSigCryptoKey=void 0,t.checkSigCryptoKey=function(e,t,...i){switch(t){case"HS256":case"HS384":case"HS512":{if(!n(e.algorithm,"HMAC"))throw r("HMAC");const a=parseInt(t.slice(2),10);if(o(e.algorithm.hash)!==a)throw r(`SHA-${a}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!n(e.algorithm,"RSASSA-PKCS1-v1_5"))throw r("RSASSA-PKCS1-v1_5");const a=parseInt(t.slice(2),10);if(o(e.algorithm.hash)!==a)throw r(`SHA-${a}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!n(e.algorithm,"RSA-PSS"))throw r("RSA-PSS");const a=parseInt(t.slice(2),10);if(o(e.algorithm.hash)!==a)throw r(`SHA-${a}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw r("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!n(e.algorithm,"ECDSA"))throw r("ECDSA");const o=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(e.algorithm.namedCurve!==o)throw r(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}a(e,i)},t.checkEncCryptoKey=function(e,t,...i){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!n(e.algorithm,"AES-GCM"))throw r("AES-GCM");const o=parseInt(t.slice(1,4),10);if(e.algorithm.length!==o)throw r(o,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!n(e.algorithm,"AES-KW"))throw r("AES-KW");const o=parseInt(t.slice(1,4),10);if(e.algorithm.length!==o)throw r(o,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw r("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!n(e.algorithm,"PBKDF2"))throw r("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!n(e.algorithm,"RSA-OAEP"))throw r("RSA-OAEP");const a=parseInt(t.slice(9),10)||1;if(o(e.algorithm.hash)!==a)throw r(`SHA-${a}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}a(e,i)}},3686:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(537),o=r(7678),a=r(7571),i=r(2338),s=r(9449),c=r(4103),d=r(5559),u=r(6484),l=r(8790),p=r(1328),f=r(534);t.default=async function(e,t,r,h,y){switch((0,l.default)(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new c.JWEInvalid("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new c.JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!(0,p.default)(h.epk))throw new c.JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!o.ecdhAllowed(t))throw new c.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");const a=await(0,u.importJWK)(h.epk,e);let i,l;if(void 0!==h.apu){if("string"!=typeof h.apu)throw new c.JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=(0,s.decode)(h.apu)}catch{throw new c.JWEInvalid("Failed to base64url decode the apu")}}if(void 0!==h.apv){if("string"!=typeof h.apv)throw new c.JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{l=(0,s.decode)(h.apv)}catch{throw new c.JWEInvalid("Failed to base64url decode the apv")}}const f=await o.deriveKey(a,t,"ECDH-ES"===e?h.enc:e,"ECDH-ES"===e?(0,d.bitLength)(h.enc):parseInt(e.slice(-5,-2),10),i,l);if("ECDH-ES"===e)return f;if(void 0===r)throw new c.JWEInvalid("JWE Encrypted Key missing");return(0,n.unwrap)(e.slice(-6),f,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new c.JWEInvalid("JWE Encrypted Key missing");return(0,i.decrypt)(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(void 0===r)throw new c.JWEInvalid("JWE Encrypted Key missing");if("number"!=typeof h.p2c)throw new c.JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');const n=(null==y?void 0:y.maxPBES2Count)||1e4;if(h.p2c>n)throw new c.JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof h.p2s)throw new c.JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let o;try{o=(0,s.decode)(h.p2s)}catch{throw new c.JWEInvalid("Failed to base64url decode the p2s")}return(0,a.decrypt)(e,t,r,h.p2c,o)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new c.JWEInvalid("JWE Encrypted Key missing");return(0,n.unwrap)(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(void 0===r)throw new c.JWEInvalid("JWE Encrypted Key missing");if("string"!=typeof h.iv)throw new c.JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof h.tag)throw new c.JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');let n,o;try{n=(0,s.decode)(h.iv)}catch{throw new c.JWEInvalid("Failed to base64url decode the iv")}try{o=(0,s.decode)(h.tag)}catch{throw new c.JWEInvalid("Failed to base64url decode the tag")}return(0,f.unwrap)(e,t,r,n,o)}default:throw new c.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}},9236:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(537),o=r(7678),a=r(7571),i=r(2338),s=r(9449),c=r(5559),d=r(4103),u=r(8784),l=r(8790),p=r(534);t.default=async function(e,t,r,f,h={}){let y,g,w;switch((0,l.default)(e,r,"encrypt"),e){case"dir":w=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!o.ecdhAllowed(r))throw new d.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");const{apu:a,apv:i}=h;let{epk:l}=h;l||(l=(await o.generateEpk(r)).privateKey);const{x:p,y:m,crv:v,kty:S}=await(0,u.exportJWK)(l),E=await o.deriveKey(r,l,"ECDH-ES"===e?t:e,"ECDH-ES"===e?(0,c.bitLength)(t):parseInt(e.slice(-5,-2),10),a,i);if(g={epk:{x:p,crv:v,kty:S}},"EC"===S&&(g.epk.y=m),a&&(g.apu=(0,s.encode)(a)),i&&(g.apv=(0,s.encode)(i)),"ECDH-ES"===e){w=E;break}w=f||(0,c.default)(t);const b=e.slice(-6);y=await(0,n.wrap)(b,E,w);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":w=f||(0,c.default)(t),y=await(0,i.encrypt)(e,r,w);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{w=f||(0,c.default)(t);const{p2c:n,p2s:o}=h;({encryptedKey:y,...g}=await(0,a.encrypt)(e,r,w,n,o));break}case"A128KW":case"A192KW":case"A256KW":w=f||(0,c.default)(t),y=await(0,n.wrap)(e,r,w);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{w=f||(0,c.default)(t);const{iv:n}=h;({encryptedKey:y,...g}=await(0,p.wrap)(e,r,w,n));break}default:throw new d.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:w,encryptedKey:y,parameters:g}}},7874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>Math.floor(e.getTime()/1e3)},1432:(e,t)=>{function r(e,t,...r){if(r.length>2){const t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}Object.defineProperty(t,"__esModule",{value:!0}),t.withAlg=void 0,t.default=(e,...t)=>r("Key must be ",e,...t),t.withAlg=function(e,t,...n){return r(`Key for the ${e} algorithm must be `,t,...n)}},2680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=(...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0}},1328:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}},4293:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bitLength=void 0;const n=r(4103),o=r(1929);function a(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new n.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}t.bitLength=a,t.default=e=>(0,o.default)(new Uint8Array(a(e)>>3))},5572:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103),o=r(405),a=r(7874),i=r(9086),s=r(1328),c=e=>e.toLowerCase().replace(/^application\//,"");t.default=(e,t,r={})=>{const{typ:d}=r;if(d&&("string"!=typeof e.typ||c(e.typ)!==c(d)))throw new n.JWTClaimValidationFailed('unexpected "typ" JWT header value',"typ","check_failed");let u;try{u=JSON.parse(o.decoder.decode(t))}catch{}if(!(0,s.default)(u))throw new n.JWTInvalid("JWT Claims Set must be a top-level JSON object");const{requiredClaims:l=[],issuer:p,subject:f,audience:h,maxTokenAge:y}=r;void 0!==y&&l.push("iat"),void 0!==h&&l.push("aud"),void 0!==f&&l.push("sub"),void 0!==p&&l.push("iss");for(const e of new Set(l.reverse()))if(!(e in u))throw new n.JWTClaimValidationFailed(`missing required "${e}" claim`,e,"missing");if(p&&!(Array.isArray(p)?p:[p]).includes(u.iss))throw new n.JWTClaimValidationFailed('unexpected "iss" claim value',"iss","check_failed");if(f&&u.sub!==f)throw new n.JWTClaimValidationFailed('unexpected "sub" claim value',"sub","check_failed");if(h&&(g=u.aud,w="string"==typeof h?[h]:h,!("string"==typeof g?w.includes(g):Array.isArray(g)&&w.some(Set.prototype.has.bind(new Set(g))))))throw new n.JWTClaimValidationFailed('unexpected "aud" claim value',"aud","check_failed");var g,w;let m;switch(typeof r.clockTolerance){case"string":m=(0,i.default)(r.clockTolerance);break;case"number":m=r.clockTolerance;break;case"undefined":m=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:v}=r,S=(0,a.default)(v||new Date);if((void 0!==u.iat||y)&&"number"!=typeof u.iat)throw new n.JWTClaimValidationFailed('"iat" claim must be a number',"iat","invalid");if(void 0!==u.nbf){if("number"!=typeof u.nbf)throw new n.JWTClaimValidationFailed('"nbf" claim must be a number',"nbf","invalid");if(u.nbf>S+m)throw new n.JWTClaimValidationFailed('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==u.exp){if("number"!=typeof u.exp)throw new n.JWTClaimValidationFailed('"exp" claim must be a number',"exp","invalid");if(u.exp<=S-m)throw new n.JWTExpired('"exp" claim timestamp check failed',"exp","check_failed")}if(y){const e=S-u.iat;if(e-m>("number"==typeof y?y:(0,i.default)(y)))throw new n.JWTExpired('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-m)throw new n.JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return u}},9086:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=86400,n=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;t.default=e=>{const t=n.exec(e);if(!t)throw new TypeError("Invalid time period format");const o=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(o);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*o);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*o);case"day":case"days":case"d":return Math.round(o*r);case"week":case"weeks":case"w":return Math.round(604800*o);default:return Math.round(31557600*o)}}},3679:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some((e=>"string"!=typeof e))))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}},2042:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103);t.default=function(e,t,r,o,a){if(void 0!==a.crit&&void 0===o.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||void 0===o.crit)return new Set;if(!Array.isArray(o.crit)||0===o.crit.length||o.crit.some((e=>"string"!=typeof e||0===e.length)))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t;for(const t of o.crit){if(!i.has(t))throw new n.JOSENotSupported(`Extension Header Parameter "${t}" is not recognized`);if(void 0===a[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(i.get(t)&&void 0===o[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(o.crit)}},537:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=t.wrap=void 0;const n=r(4300),o=r(6113),a=r(4103),i=r(405),s=r(5538),c=r(195),d=r(9984),u=r(1432),l=r(7117),p=r(1766);function f(e,t){if(e.symmetricKeySize<<3!==parseInt(t.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${t}`)}function h(e,t,r){if((0,d.default)(e))return e;if(e instanceof Uint8Array)return(0,o.createSecretKey)(e);if((0,s.isCryptoKey)(e))return(0,c.checkEncCryptoKey)(e,t,r),o.KeyObject.from(e);throw new TypeError((0,u.default)(e,...p.types,"Uint8Array"))}t.wrap=(e,t,r)=>{const s=`aes${parseInt(e.slice(1,4),10)}-wrap`;if(!(0,l.default)(s))throw new a.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`);const c=h(t,e,"wrapKey");f(c,e);const d=(0,o.createCipheriv)(s,c,n.Buffer.alloc(8,166));return(0,i.concat)(d.update(r),d.final())};t.unwrap=(e,t,r)=>{const s=`aes${parseInt(e.slice(1,4),10)}-wrap`;if(!(0,l.default)(s))throw new a.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`);const c=h(t,e,"unwrapKey");f(c,e);const d=(0,o.createDecipheriv)(s,c,n.Buffer.alloc(8,166));return(0,i.concat)(d.update(r),d.final())}},970:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromX509=t.fromSPKI=t.fromPKCS8=t.toPKCS8=t.toSPKI=void 0;const n=r(6113),o=r(4300),a=r(5538),i=r(9984),s=r(1432),c=r(1766),d=(e,t,r)=>{let o;if((0,a.isCryptoKey)(r)){if(!r.extractable)throw new TypeError("CryptoKey is not extractable");o=n.KeyObject.from(r)}else{if(!(0,i.default)(r))throw new TypeError((0,s.default)(r,...c.types));o=r}if(o.type!==e)throw new TypeError(`key is not a ${e} key`);return o.export({format:"pem",type:t})};t.toSPKI=e=>d("public","spki",e);t.toPKCS8=e=>d("private","pkcs8",e);t.fromPKCS8=e=>(0,n.createPrivateKey)({key:o.Buffer.from(e.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""),"base64"),type:"pkcs8",format:"der"});t.fromSPKI=e=>(0,n.createPublicKey)({key:o.Buffer.from(e.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""),"base64"),type:"spki",format:"der"});t.fromX509=e=>(0,n.createPublicKey)({key:e,type:"spki",format:"pem"})},2358:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){if(48!==e[0])throw new TypeError;this.buffer=e,this.offset=1;if(this.decodeLength()!==e.length-this.offset)throw new TypeError}decodeLength(){let e=this.buffer[this.offset++];if(128&e){const t=-129&e;e=0;for(let r=0;r<t;r++)e=e<<8|this.buffer[this.offset+r];this.offset+=t}return e}unsignedInteger(){if(2!==this.buffer[this.offset++])throw new TypeError;let e=this.decodeLength();0===this.buffer[this.offset]&&(this.offset++,e--);const t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}end(){if(this.offset!==this.buffer.length)throw new TypeError}}},295:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4300),o=r(4103),a=n.Buffer.from([0]),i=n.Buffer.from([2]),s=n.Buffer.from([3]),c=n.Buffer.from([48]),d=n.Buffer.from([4]),u=e=>{if(e<128)return n.Buffer.from([e]);const t=n.Buffer.alloc(5);t.writeUInt32BE(e,1);let r=1;for(;0===t[r];)r++;return t[r-1]=128|5-r,t.slice(r-1)},l=new Map([["P-256",n.Buffer.from("06 08 2A 86 48 CE 3D 03 01 07".replace(/ /g,""),"hex")],["secp256k1",n.Buffer.from("06 05 2B 81 04 00 0A".replace(/ /g,""),"hex")],["P-384",n.Buffer.from("06 05 2B 81 04 00 22".replace(/ /g,""),"hex")],["P-521",n.Buffer.from("06 05 2B 81 04 00 23".replace(/ /g,""),"hex")],["ecPublicKey",n.Buffer.from("06 07 2A 86 48 CE 3D 02 01".replace(/ /g,""),"hex")],["X25519",n.Buffer.from("06 03 2B 65 6E".replace(/ /g,""),"hex")],["X448",n.Buffer.from("06 03 2B 65 6F".replace(/ /g,""),"hex")],["Ed25519",n.Buffer.from("06 03 2B 65 70".replace(/ /g,""),"hex")],["Ed448",n.Buffer.from("06 03 2B 65 71".replace(/ /g,""),"hex")]]);t.default=class{constructor(){this.length=0,this.elements=[]}oidFor(e){const t=l.get(e);if(!t)throw new o.JOSENotSupported("Invalid or unsupported OID");this.elements.push(t),this.length+=t.length}zero(){this.elements.push(i,n.Buffer.from([1]),a),this.length+=3}one(){this.elements.push(i,n.Buffer.from([1]),n.Buffer.from([1])),this.length+=3}unsignedInteger(e){if(128&e[0]){const t=u(e.length+1);this.elements.push(i,t,a,e),this.length+=2+t.length+e.length}else{let t=0;for(;0===e[t]&&0==(128&e[t+1]);)t++;const r=u(e.length-t);this.elements.push(i,u(e.length-t),e.slice(t)),this.length+=1+r.length+e.length-t}}octStr(e){const t=u(e.length);this.elements.push(d,u(e.length),e),this.length+=1+t.length+e.length}bitStr(e){const t=u(e.length+1);this.elements.push(s,u(e.length+1),a,e),this.length+=1+t.length+e.length+1}add(e){this.elements.push(e),this.length+=e.length}end(e=c){const t=u(this.length);return n.Buffer.concat([e,t,...this.elements],1+t.length+this.length)}}},9449:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=t.encodeBase64=t.decodeBase64=void 0;const n=r(4300),o=r(405);let a;n.Buffer.isEncoding("base64url")?t.encode=a=e=>n.Buffer.from(e).toString("base64url"):t.encode=a=e=>n.Buffer.from(e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");t.decodeBase64=e=>n.Buffer.from(e,"base64");t.encodeBase64=e=>n.Buffer.from(e).toString("base64");t.decode=e=>n.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=o.decoder.decode(t)),t}(e),"base64")},3265:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(405);t.default=function(e,t,r,a,i,s){const c=(0,o.concat)(e,t,r,(0,o.uint64be)(e.length<<3)),d=(0,n.createHmac)(`sha${a}`,i);return d.update(c),d.digest().slice(0,s>>3)}},9626:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103),o=r(9984);t.default=(e,t)=>{let r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new n.JOSENotSupported(`Content Encryption Algorithm ${e} is not supported either by JOSE or your javascript runtime`)}if(t instanceof Uint8Array){const e=t.byteLength<<3;if(e!==r)throw new n.JWEInvalid(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`)}else{if(!(0,o.default)(t)||"secret"!==t.type)throw new TypeError("Invalid Content Encryption Key type");{const e=t.symmetricKeySize<<3;if(e!==r)throw new n.JWEInvalid(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`)}}}},9650:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setModulusLength=t.weakMap=void 0,t.weakMap=new WeakMap;const r=(e,t)=>{let n=e.readUInt8(1);if(0==(128&n))return 0===t?n:r(e.subarray(2+n),t-1);const o=127&n;n=0;for(let t=0;t<o;t++){n<<=8;n|=e.readUInt8(2+t)}return 0===t?n:r(e.subarray(2+n),t-1)},n=e=>{var n,o;if(t.weakMap.has(e))return t.weakMap.get(e);const a=null!==(o=null===(n=e.asymmetricKeyDetails)||void 0===n?void 0:n.modulusLength)&&void 0!==o?o:((e,t)=>{const n=e.readUInt8(1);if(0==(128&n))return r(e.subarray(2),t);const o=127&n;return r(e.subarray(2+o),t)})(e.export({format:"der",type:"pkcs1"}),"private"===e.type?1:0)-1<<3;return t.weakMap.set(e,a),a};t.setModulusLength=(e,r)=>{t.weakMap.set(e,r)},t.default=(e,t)=>{if(n(e)<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}},7117:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113);let o;t.default=e=>(o||(o=new Set((0,n.getCiphers)())),o.has(e))},3963:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(5202),a=r(9626),i=r(405),s=r(4103),c=r(7458),d=r(3265),u=r(5538),l=r(195),p=r(9984),f=r(1432),h=r(7117),y=r(1766);t.default=(e,t,r,g,w,m)=>{let v;if((0,u.isCryptoKey)(t))(0,l.checkEncCryptoKey)(t,e,"decrypt"),v=n.KeyObject.from(t);else{if(!(t instanceof Uint8Array||(0,p.default)(t)))throw new TypeError((0,f.default)(t,...y.types,"Uint8Array"));v=t}switch((0,a.default)(e,v),(0,o.default)(e,g),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,o,a,u){const l=parseInt(e.slice(1,4),10);(0,p.default)(t)&&(t=t.export());const f=t.subarray(l>>3),y=t.subarray(0,l>>3),g=parseInt(e.slice(-3),10),w=`aes-${l}-cbc`;if(!(0,h.default)(w))throw new s.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);const m=(0,d.default)(u,o,r,g,y,l);let v,S;try{v=(0,c.default)(a,m)}catch{}if(!v)throw new s.JWEDecryptionFailed;try{const e=(0,n.createDecipheriv)(w,f,o);S=(0,i.concat)(e.update(r),e.final())}catch{}if(!S)throw new s.JWEDecryptionFailed;return S}(e,v,r,g,w,m);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,o,a,i){const c=`aes-${parseInt(e.slice(1,4),10)}-gcm`;if(!(0,h.default)(c))throw new s.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);try{const e=(0,n.createDecipheriv)(c,t,o,{authTagLength:16});e.setAuthTag(a),i.byteLength&&e.setAAD(i,{plaintextLength:r.length});const s=e.update(r);return e.final(),s}catch{throw new s.JWEDecryptionFailed}}(e,v,r,g,w,m);default:throw new s.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}}},1100:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113);t.default=(e,t)=>(0,n.createHash)(e).update(t).digest()},3445:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103);t.default=function(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"EdDSA":return;default:throw new n.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}},7678:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ecdhAllowed=t.generateEpk=t.deriveKey=void 0;const n=r(6113),o=r(3837),a=r(5987),i=r(405),s=r(4103),c=r(5538),d=r(195),u=r(9984),l=r(1432),p=r(1766),f=(0,o.promisify)(n.generateKeyPair);t.deriveKey=async function(e,t,r,o,a=new Uint8Array(0),s=new Uint8Array(0)){let f,h;if((0,c.isCryptoKey)(e))(0,d.checkEncCryptoKey)(e,"ECDH"),f=n.KeyObject.from(e);else{if(!(0,u.default)(e))throw new TypeError((0,l.default)(e,...p.types));f=e}if((0,c.isCryptoKey)(t))(0,d.checkEncCryptoKey)(t,"ECDH","deriveBits"),h=n.KeyObject.from(t);else{if(!(0,u.default)(t))throw new TypeError((0,l.default)(t,...p.types));h=t}const y=(0,i.concat)((0,i.lengthAndInput)(i.encoder.encode(r)),(0,i.lengthAndInput)(a),(0,i.lengthAndInput)(s),(0,i.uint32be)(o)),g=(0,n.diffieHellman)({privateKey:h,publicKey:f});return(0,i.concatKdf)(g,o,y)},t.generateEpk=async function(e){let t;if((0,c.isCryptoKey)(e))t=n.KeyObject.from(e);else{if(!(0,u.default)(e))throw new TypeError((0,l.default)(e,...p.types));t=e}switch(t.asymmetricKeyType){case"x25519":return f("x25519");case"x448":return f("x448");case"ec":{const e=(0,a.default)(t);return f("ec",{namedCurve:e})}default:throw new s.JOSENotSupported("Invalid or unsupported EPK")}};t.ecdhAllowed=e=>["P-256","P-384","P-521","X25519","X448"].includes((0,a.default)(e))},7877:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(5202),a=r(9626),i=r(405),s=r(3265),c=r(5538),d=r(195),u=r(9984),l=r(1432),p=r(4103),f=r(7117),h=r(1766);t.default=(e,t,r,y,g)=>{let w;if((0,c.isCryptoKey)(r))(0,d.checkEncCryptoKey)(r,e,"encrypt"),w=n.KeyObject.from(r);else{if(!(r instanceof Uint8Array||(0,u.default)(r)))throw new TypeError((0,l.default)(r,...h.types,"Uint8Array"));w=r}switch((0,a.default)(e,w),(0,o.default)(e,y),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,o,a){const c=parseInt(e.slice(1,4),10);(0,u.default)(r)&&(r=r.export());const d=r.subarray(c>>3),l=r.subarray(0,c>>3),h=`aes-${c}-cbc`;if(!(0,f.default)(h))throw new p.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);const y=(0,n.createCipheriv)(h,d,o),g=(0,i.concat)(y.update(t),y.final()),w=parseInt(e.slice(-3),10);return{ciphertext:g,tag:(0,s.default)(a,o,g,w,l,c)}}(e,t,w,y,g);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,o,a){const i=`aes-${parseInt(e.slice(1,4),10)}-gcm`;if(!(0,f.default)(i))throw new p.JOSENotSupported(`alg ${e} is not supported by your javascript runtime`);const s=(0,n.createCipheriv)(i,r,o,{authTagLength:16});a.byteLength&&s.setAAD(a,{plaintextLength:t.length});const c=s.update(t);return s.final(),{ciphertext:c,tag:s.getAuthTag()}}(e,t,w,y,g);default:throw new p.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}}},1313:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(3685),o=r(5687),a=r(2361),i=r(4103),s=r(405);t.default=async(e,t,r)=>{let c;switch(e.protocol){case"https:":c=o.get;break;case"http:":c=n.get;break;default:throw new TypeError("Unsupported URL protocol.")}const{agent:d,headers:u}=r,l=c(e.href,{agent:d,timeout:t,headers:u}),[p]=await Promise.race([(0,a.once)(l,"response"),(0,a.once)(l,"timeout")]);if(!p)throw l.destroy(),new i.JWKSTimeout;if(200!==p.statusCode)throw new i.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");const f=[];for await(const e of p)f.push(e);try{return JSON.parse(s.decoder.decode((0,s.concat)(...f)))}catch{throw new i.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}}},560:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.jwkImport=t.jwkExport=t.rsaPssParams=t.oneShotCallback=void 0;const[r,n]=process.versions.node.split(".").map((e=>parseInt(e,10)));t.oneShotCallback=r>=16||15===r&&n>=13,t.rsaPssParams=!("electron"in process.versions)&&(r>=17||16===r&&n>=9),t.jwkExport=r>=16||15===r&&n>=9,t.jwkImport=r>=16||15===r&&n>=12},3114:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateKeyPair=t.generateSecret=void 0;const n=r(6113),o=r(3837),a=r(1929),i=r(9650),s=r(4103),c=(0,o.promisify)(n.generateKeyPair);t.generateSecret=async function(e,t){let r;switch(e){case"HS256":case"HS384":case"HS512":case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128KW":case"A192KW":case"A256KW":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new s.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return(0,n.createSecretKey)((0,a.default)(new Uint8Array(r>>3)))},t.generateKeyPair=async function(e,t){var r,n;switch(e){case"RS256":case"RS384":case"RS512":case"PS256":case"PS384":case"PS512":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":case"RSA1_5":{const e=null!==(r=null==t?void 0:t.modulusLength)&&void 0!==r?r:2048;if("number"!=typeof e||e<2048)throw new s.JOSENotSupported("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");const n=await c("rsa",{modulusLength:e,publicExponent:65537});return(0,i.setModulusLength)(n.privateKey,e),(0,i.setModulusLength)(n.publicKey,e),n}case"ES256":return c("ec",{namedCurve:"P-256"});case"ES256K":return c("ec",{namedCurve:"secp256k1"});case"ES384":return c("ec",{namedCurve:"P-384"});case"ES512":return c("ec",{namedCurve:"P-521"});case"EdDSA":switch(null==t?void 0:t.crv){case void 0:case"Ed25519":return c("ed25519");case"Ed448":return c("ed448");default:throw new s.JOSENotSupported("Invalid or unsupported crv option provided, supported values are Ed25519 and Ed448")}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":const e=null!==(n=null==t?void 0:t.crv)&&void 0!==n?n:"P-256";switch(e){case void 0:case"P-256":case"P-384":case"P-521":return c("ec",{namedCurve:e});case"X25519":return c("x25519");case"X448":return c("x448");default:throw new s.JOSENotSupported("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}default:throw new s.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}}},5987:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setCurve=t.weakMap=void 0;const n=r(4300),o=r(6113),a=r(4103),i=r(5538),s=r(9984),c=r(1432),d=r(1766),u=n.Buffer.from([42,134,72,206,61,3,1,7]),l=n.Buffer.from([43,129,4,0,34]),p=n.Buffer.from([43,129,4,0,35]),f=n.Buffer.from([43,129,4,0,10]);t.weakMap=new WeakMap;const h=(e,r)=>{var n;let y;if((0,i.isCryptoKey)(e))y=o.KeyObject.from(e);else{if(!(0,s.default)(e))throw new TypeError((0,c.default)(e,...d.types));y=e}if("secret"===y.type)throw new TypeError('only "private" or "public" type keys can be used for this operation');switch(y.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${y.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${y.asymmetricKeyType.slice(1)}`;case"ec":{if(t.weakMap.has(y))return t.weakMap.get(y);let e=null===(n=y.asymmetricKeyDetails)||void 0===n?void 0:n.namedCurve;if(e||"private"!==y.type){if(!e){const t=y.export({format:"der",type:"spki"}),r=t[1]<128?14:15,n=t[r],o=t.slice(r+1,r+1+n);if(o.equals(u))e="prime256v1";else if(o.equals(l))e="secp384r1";else if(o.equals(p))e="secp521r1";else{if(!o.equals(f))throw new a.JOSENotSupported("Unsupported key curve for this operation");e="secp256k1"}}}else e=h((0,o.createPublicKey)(y),!0);if(r)return e;const i=(e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new a.JOSENotSupported("Unsupported key curve for this operation")}})(e);return t.weakMap.set(y,i),i}default:throw new TypeError("Invalid asymmetric key type for this operation")}};t.setCurve=function(e,r){t.weakMap.set(e,r)},t.default=h},1228:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(5538),a=r(195),i=r(1432),s=r(1766);t.default=function(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError((0,i.default)(t,...s.types));return(0,n.createSecretKey)(t)}if(t instanceof n.KeyObject)return t;if((0,o.isCryptoKey)(t))return(0,a.checkSigCryptoKey)(t,e,r),n.KeyObject.from(t);throw new TypeError((0,i.default)(t,...s.types,"Uint8Array"))}},9771:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4103);t.default=function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new n.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}},1766:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.types=void 0;const n=r(5538),o=r(9984);t.default=e=>(0,o.default)(e)||(0,n.isCryptoKey)(e);const a=["KeyObject"];t.types=a,(globalThis.CryptoKey||(null===n.default||void 0===n.default?void 0:n.default.CryptoKey))&&a.push("CryptoKey")},9984:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(3837);t.default=o.types.isKeyObject?e=>o.types.isKeyObject(e):e=>null!=e&&e instanceof n.KeyObject},1522:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(4300),o=r(6113),a=r(9449),i=r(4103),s=r(5987),c=r(9650),d=r(295),u=r(560);t.default=e=>{if(u.jwkImport&&"oct"!==e.kty)return e.d?(0,o.createPrivateKey)({format:"jwk",key:e}):(0,o.createPublicKey)({format:"jwk",key:e});switch(e.kty){case"oct":return(0,o.createSecretKey)((0,a.decode)(e.k));case"RSA":{const t=new d.default,r=void 0!==e.d,a=n.Buffer.from(e.n,"base64"),i=n.Buffer.from(e.e,"base64");r?(t.zero(),t.unsignedInteger(a),t.unsignedInteger(i),t.unsignedInteger(n.Buffer.from(e.d,"base64")),t.unsignedInteger(n.Buffer.from(e.p,"base64")),t.unsignedInteger(n.Buffer.from(e.q,"base64")),t.unsignedInteger(n.Buffer.from(e.dp,"base64")),t.unsignedInteger(n.Buffer.from(e.dq,"base64")),t.unsignedInteger(n.Buffer.from(e.qi,"base64"))):(t.unsignedInteger(a),t.unsignedInteger(i));const s={key:t.end(),format:"der",type:"pkcs1"},u=r?(0,o.createPrivateKey)(s):(0,o.createPublicKey)(s);return(0,c.setModulusLength)(u,a.length<<3),u}case"EC":{const t=new d.default,r=void 0!==e.d,a=n.Buffer.concat([n.Buffer.alloc(1,4),n.Buffer.from(e.x,"base64"),n.Buffer.from(e.y,"base64")]);if(r){t.zero();const r=new d.default;r.oidFor("ecPublicKey"),r.oidFor(e.crv),t.add(r.end());const i=new d.default;i.one(),i.octStr(n.Buffer.from(e.d,"base64"));const c=new d.default;c.bitStr(a);const u=c.end(n.Buffer.from([161]));i.add(u);const l=i.end(),p=new d.default;p.add(l);const f=p.end(n.Buffer.from([4]));t.add(f);const h=t.end(),y=(0,o.createPrivateKey)({key:h,format:"der",type:"pkcs8"});return(0,s.setCurve)(y,e.crv),y}const i=new d.default;i.oidFor("ecPublicKey"),i.oidFor(e.crv),t.add(i.end()),t.bitStr(a);const c=t.end(),u=(0,o.createPublicKey)({key:c,format:"der",type:"spki"});return(0,s.setCurve)(u,e.crv),u}case"OKP":{const t=new d.default;if(void 0!==e.d){t.zero();const r=new d.default;r.oidFor(e.crv),t.add(r.end());const a=new d.default;a.octStr(n.Buffer.from(e.d,"base64"));const i=a.end(n.Buffer.from([4]));t.add(i);const s=t.end();return(0,o.createPrivateKey)({key:s,format:"der",type:"pkcs8"})}const r=new d.default;r.oidFor(e.crv),t.add(r.end()),t.bitStr(n.Buffer.from(e.x,"base64"));const a=t.end();return(0,o.createPublicKey)({key:a,format:"der",type:"spki"})}default:throw new i.JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}}},448:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(9449),a=r(2358),i=r(4103),s=r(5987),c=r(5538),d=r(9984),u=r(1432),l=r(1766),p=r(560),f=e=>{let t;if((0,c.isCryptoKey)(e)){if(!e.extractable)throw new TypeError("CryptoKey is not extractable");t=n.KeyObject.from(e)}else{if(!(0,d.default)(e)){if(e instanceof Uint8Array)return{kty:"oct",k:(0,o.encode)(e)};throw new TypeError((0,u.default)(e,...l.types,"Uint8Array"))}t=e}if(p.jwkExport){if("secret"!==t.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(t.asymmetricKeyType))throw new i.JOSENotSupported("Unsupported key asymmetricKeyType");return t.export({format:"jwk"})}switch(t.type){case"secret":return{kty:"oct",k:(0,o.encode)(t.export())};case"private":case"public":switch(t.asymmetricKeyType){case"rsa":{const e=t.export({format:"der",type:"pkcs1"}),r=new a.default(e);"private"===t.type&&r.unsignedInteger();const n=(0,o.encode)(r.unsignedInteger()),i=(0,o.encode)(r.unsignedInteger());let s;return"private"===t.type&&(s={d:(0,o.encode)(r.unsignedInteger()),p:(0,o.encode)(r.unsignedInteger()),q:(0,o.encode)(r.unsignedInteger()),dp:(0,o.encode)(r.unsignedInteger()),dq:(0,o.encode)(r.unsignedInteger()),qi:(0,o.encode)(r.unsignedInteger())}),r.end(),{kty:"RSA",n,e:i,...s}}case"ec":{const e=(0,s.default)(t);let r,a,c;switch(e){case"secp256k1":r=64,a=33,c=-1;break;case"P-256":r=64,a=36,c=-1;break;case"P-384":r=96,a=35,c=-3;break;case"P-521":r=132,a=35,c=-3;break;default:throw new i.JOSENotSupported("Unsupported curve")}if("public"===t.type){const n=t.export({type:"spki",format:"der"});return{kty:"EC",crv:e,x:(0,o.encode)(n.subarray(-r,-r/2)),y:(0,o.encode)(n.subarray(-r/2))}}const d=t.export({type:"pkcs8",format:"der"});return d.length<100&&(a+=c),{...f((0,n.createPublicKey)(t)),d:(0,o.encode)(d.subarray(a,a+r/2))}}case"ed25519":case"x25519":{const e=(0,s.default)(t);if("public"===t.type){const r=t.export({type:"spki",format:"der"});return{kty:"OKP",crv:e,x:(0,o.encode)(r.subarray(-32))}}const r=t.export({type:"pkcs8",format:"der"});return{...f((0,n.createPublicKey)(t)),d:(0,o.encode)(r.subarray(-32))}}case"ed448":case"x448":{const e=(0,s.default)(t);if("public"===t.type){const r=t.export({type:"spki",format:"der"});return{kty:"OKP",crv:e,x:(0,o.encode)(r.subarray("Ed448"===e?-57:-56))}}const r=t.export({type:"pkcs8",format:"der"});return{...f((0,n.createPublicKey)(t)),d:(0,o.encode)(r.subarray("Ed448"===e?-57:-56))}}default:throw new i.JOSENotSupported("Unsupported key asymmetricKeyType")}default:throw new i.JOSENotSupported("Unsupported key type")}};t.default=f},7342:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(5987),a=r(4103),i=r(9650),s=r(560),c={padding:n.constants.RSA_PKCS1_PSS_PADDING,saltLength:n.constants.RSA_PSS_SALTLEN_DIGEST},d=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);t.default=function(e,t){switch(e){case"EdDSA":if(!["ed25519","ed448"].includes(t.asymmetricKeyType))throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");return t;case"RS256":case"RS384":case"RS512":if("rsa"!==t.asymmetricKeyType)throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");return(0,i.default)(t,e),t;case s.rsaPssParams&&"PS256":case s.rsaPssParams&&"PS384":case s.rsaPssParams&&"PS512":if("rsa-pss"===t.asymmetricKeyType){const{hashAlgorithm:r,mgf1HashAlgorithm:n,saltLength:o}=t.asymmetricKeyDetails,a=parseInt(e.slice(-3),10);if(void 0!==r&&(r!==`sha${a}`||n!==r))throw new TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==o&&o>a>>3)throw new TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==t.asymmetricKeyType)throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");return(0,i.default)(t,e),{key:t,...c};case!s.rsaPssParams&&"PS256":case!s.rsaPssParams&&"PS384":case!s.rsaPssParams&&"PS512":if("rsa"!==t.asymmetricKeyType)throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");return(0,i.default)(t,e),{key:t,...c};case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==t.asymmetricKeyType)throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");const r=(0,o.default)(t),n=d.get(e);if(r!==n)throw new TypeError(`Invalid key curve for the algorithm, its curve must be ${n}, got ${r}`);return{dsaEncoding:"ieee-p1363",key:t}}default:throw new a.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}},7571:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=void 0;const n=r(3837),o=r(6113),a=r(1929),i=r(405),s=r(9449),c=r(537),d=r(7990),u=r(5538),l=r(195),p=r(9984),f=r(1432),h=r(1766),y=(0,n.promisify)(o.pbkdf2);function g(e,t){if((0,p.default)(e))return e.export();if(e instanceof Uint8Array)return e;if((0,u.isCryptoKey)(e))return(0,l.checkEncCryptoKey)(e,t,"deriveBits","deriveKey"),o.KeyObject.from(e).export();throw new TypeError((0,f.default)(e,...h.types,"Uint8Array"))}t.encrypt=async(e,t,r,n=2048,o=(0,a.default)(new Uint8Array(16)))=>{(0,d.default)(o);const u=(0,i.p2s)(e,o),l=parseInt(e.slice(13,16),10)>>3,p=g(t,e),f=await y(p,u,n,l,`sha${e.slice(8,11)}`);return{encryptedKey:await(0,c.wrap)(e.slice(-6),f,r),p2c:n,p2s:(0,s.encode)(o)}};t.decrypt=async(e,t,r,n,o)=>{(0,d.default)(o);const a=(0,i.p2s)(e,o),s=parseInt(e.slice(13,16),10)>>3,u=g(t,e),l=await y(u,a,n,s,`sha${e.slice(8,11)}`);return(0,c.unwrap)(e.slice(-6),l,r)}},1929:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(6113);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n.randomFillSync}})},2338:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=void 0;const n=r(6113),o=r(9650),a=r(5538),i=r(195),s=r(9984),c=r(1432),d=r(1766),u=(e,t)=>{if("rsa"!==e.asymmetricKeyType)throw new TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");(0,o.default)(e,t)},l=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return n.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return n.constants.RSA_PKCS1_PADDING;default:return}},p=e=>{switch(e){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function f(e,t,...r){if((0,s.default)(e))return e;if((0,a.isCryptoKey)(e))return(0,i.checkEncCryptoKey)(e,t,...r),n.KeyObject.from(e);throw new TypeError((0,c.default)(e,...d.types))}t.encrypt=(e,t,r)=>{const o=l(e),a=p(e),i=f(t,e,"wrapKey","encrypt");return u(i,e),(0,n.publicEncrypt)({key:i,oaepHash:a,padding:o},r)};t.decrypt=(e,t,r)=>{const o=l(e),a=p(e),i=f(t,e,"unwrapKey","decrypt");return u(i,e),(0,n.privateDecrypt)({key:i,oaepHash:a,padding:o},r)}},690:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="node:crypto"},164:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(3837),a=r(3445),i=r(9771),s=r(7342),c=r(1228);let d;d=n.sign.length>3?(0,o.promisify)(n.sign):n.sign;t.default=async(e,t,r)=>{const o=(0,c.default)(e,t,"sign");if(e.startsWith("HS")){const t=n.createHmac((0,i.default)(e),o);return t.update(r),t.digest()}return d((0,a.default)(e),r,(0,s.default)(e,o))}},7458:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113).timingSafeEqual;t.default=n},5723:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6113),o=r(3837),a=r(3445),i=r(7342),s=r(164),c=r(1228),d=r(560);let u;u=n.verify.length>4&&d.oneShotCallback?(0,o.promisify)(n.verify):n.verify;t.default=async(e,t,r,o)=>{const d=(0,c.default)(e,t,"verify");if(e.startsWith("HS")){const t=await(0,s.default)(e,d,o),a=r;try{return n.timingSafeEqual(a,t)}catch{return!1}}const l=(0,a.default)(e),p=(0,i.default)(e,d);try{return await u(l,o,p,r)}catch{return!1}}},5538:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCryptoKey=void 0;const n=r(6113),o=r(3837),a=n.webcrypto;t.default=a,t.isCryptoKey=o.types.isCryptoKey?e=>o.types.isCryptoKey(e):e=>!1},7247:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deflate=t.inflate=void 0;const n=r(3837),o=r(9796),a=(0,n.promisify)(o.inflateRaw),i=(0,n.promisify)(o.deflateRaw);t.inflate=e=>a(e);t.deflate=e=>i(e)},9989:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0;const n=r(9449);t.encode=n.encode,t.decode=n.decode},7084:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeJwt=void 0;const n=r(9989),o=r(405),a=r(1328),i=r(4103);t.decodeJwt=function(e){if("string"!=typeof e)throw new i.JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(5===r)throw new i.JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==r)throw new i.JWTInvalid("Invalid JWT");if(!t)throw new i.JWTInvalid("JWTs must contain a payload");let s,c;try{s=(0,n.decode)(t)}catch{throw new i.JWTInvalid("Failed to base64url decode the payload")}try{c=JSON.parse(o.decoder.decode(s))}catch{throw new i.JWTInvalid("Failed to parse the decoded payload as JSON")}if(!(0,a.default)(c))throw new i.JWTInvalid("Invalid JWT Claims Set");return c}},2945:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtectedHeader=void 0;const n=r(9989),o=r(405),a=r(1328);t.decodeProtectedHeader=function(e){let t;if("string"==typeof e){const r=e.split(".");3!==r.length&&5!==r.length||([t]=r)}else if("object"==typeof e&&e){if(!("protected"in e))throw new TypeError("Token does not contain a Protected Header");t=e.protected}try{if("string"!=typeof t||!t)throw new Error;const e=JSON.parse(o.decoder.decode((0,n.decode)(t)));if(!(0,a.default)(e))throw new Error;return e}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}},4103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JWSSignatureVerificationFailed=t.JWKSTimeout=t.JWKSMultipleMatchingKeys=t.JWKSNoMatchingKey=t.JWKSInvalid=t.JWKInvalid=t.JWTInvalid=t.JWSInvalid=t.JWEInvalid=t.JWEDecryptionFailed=t.JOSENotSupported=t.JOSEAlgNotAllowed=t.JWTExpired=t.JWTClaimValidationFailed=t.JOSEError=void 0;class r extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}t.JOSEError=r;t.JWTClaimValidationFailed=class extends r{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}};t.JWTExpired=class extends r{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}};t.JOSEAlgNotAllowed=class extends r{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}};t.JOSENotSupported=class extends r{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}};t.JWEDecryptionFailed=class extends r{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}};t.JWEInvalid=class extends r{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}};t.JWSInvalid=class extends r{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}};t.JWTInvalid=class extends r{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};t.JWKInvalid=class extends r{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}};t.JWKSInvalid=class extends r{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}};t.JWKSNoMatchingKey=class extends r{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}};t.JWKSMultipleMatchingKeys=class extends r{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Symbol.asyncIterator;t.JWKSTimeout=class extends r{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}};t.JWSSignatureVerificationFailed=class extends r{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}},9059:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(690);t.default=n.default},8381:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.handler=void 0;const i=r(6113),s=r(3477),c=a(r(3249)),d=a(r(9978)),u=c.getCompleteConfig();u.logger.debug("Configuration loaded:",u);function l({nonce:e,nonceLength:t,nonceSigningSecret:r,cookieSettings:n}){return[{key:"set-cookie",value:`spa-auth-edge-nonce=${encodeURIComponent(e)}; ${n.nonce}`},{key:"set-cookie",value:`spa-auth-edge-nonce-hmac=${encodeURIComponent(c.sign(e,r,t))}; ${n.nonce}`}]}function p(){const e=c.generateSecret(u.secretAllowedCharacters,u.pkceLength),t={pkce:e,pkceHash:c.urlSafe.stringify((0,i.createHash)("sha256").update(e,"utf8").digest("base64"))};return u.logger.debug("Generated PKCE verifier:\n",t),t}function f(){const e=c.generateSecret(u.secretAllowedCharacters,u.nonceLength),t=`${c.timestampInSeconds()}T${e}`;return u.logger.debug("Generated new nonce:",t),t}t.handler=async e=>{u.logger.debug("Event:",e);const t=e.Records[0].cf.request,r=t.headers.host[0].value,n=`${t.uri}${t.querystring?"?"+t.querystring:""}`;try{const e=c.extractAndParseCookies(t.headers,u.clientId,u.idTokenCookieName);if(u.logger.debug("Extracted cookies:",e),!e.accessToken)throw new Error("No access token present in cookies");const o={"Content-Type":"application/x-www-form-urlencoded"};if(u.clientSecret){const e=Buffer.from(`${u.clientId}:${u.clientSecret}`).toString("base64");o.Authorization=`Basic ${e}`}const a=(0,s.stringify)({token:e.accessToken}),i=await c.httpPostToIDPWithRetry(u.introspectEndpoint,Buffer.from(a),{headers:o},u.logger,"POST").catch((e=>{throw new Error(`Failed to get access token info: ${e}`)}));if(u.logger.debug(`accessTokenInfo: ${JSON.stringify(i)}`),!i.data.active)return u.logger.debug("Redirecting user to refresh path"),function({domainName:e,requestedUri:t}){const r=f(),n={status:"307",statusDescription:"Temporary Redirect",headers:{location:[{key:"location",value:`https://${e}${u.redirectPathAuthRefresh}?${(0,s.stringify)({requestedUri:t,nonce:r})}`}],"set-cookie":l({nonce:r,...u}),...u.cloudFrontHeaders}};return u.logger.debug("Returning response:\n",n),n}({domainName:r,requestedUri:n});t.headers.Authorization=[{key:"Authorization",value:"Bearer "+e.idToken}],u.logger.debug("Access allowed:",t);const p="https://www.googleapis.com/oauth2/v1/certs";u.logger.debug(`Fetching JWKS for ${p}`);const h=(await c.fetchUrl(p)).toString();u.logger.debug(`Fetched JWKS: ${h}`);const y=d.createLocalJWKSet(JSON.parse(h)),{payload:g,protectedHeader:w}=await d.jwtVerify(e.idToken,y,{issuer:"https://accounts.google.com",audience:u.clientId});return u.logger.debug(w),u.logger.debug(g),t.uri.includes(u.staticContentPathPattern)&&!t.uri.includes(".")&&(t.uri=u.staticContentRootObject),t}catch(e){return u.logger.info("Access denied:",e),e instanceof d.errors.JWTExpired?(u.logger.debug("It is ok to use expired idToken since we are using accessToken to maintain the session"),u.logger.debug("Access allowed dispite the expired idToken:",t),t):(u.logger.debug("Redirecting user to IDP to sign-in"),function({domainName:e,requestedUri:t}){const r=f(),n={nonce:r,nonceHmac:c.sign(r,u.nonceSigningSecret,u.nonceLength),...p()};u.logger.debug("Using new state\n",n);const o=(0,s.stringify)({redirect_uri:`https://${e}${u.redirectPathSignIn}`,response_type:"code",client_id:u.clientId,state:c.urlSafe.stringify(Buffer.from(JSON.stringify({nonce:n.nonce,requestedUri:t})).toString("base64")),scope:u.oauthScopes.join(" "),code_challenge_method:"S256",code_challenge:n.pkceHash}),a={status:"307",statusDescription:"Temporary Redirect",headers:{location:[{key:"location",value:`${u.authEndpoint}?${o}`}],"set-cookie":[...l({nonce:r,...u}),{key:"set-cookie",value:`spa-auth-edge-pkce=${encodeURIComponent(n.pkce)}; ${u.cookieSettings.nonce}`}],...u.cloudFrontHeaders}};return u.logger.debug("Returning response:\n",a),a}({domainName:r,requestedUri:n}))}}},4443:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=void 0;const n=r(5687),o=r(2781);t.fetch=async function(e,t,r){return new Promise(((i,s)=>{const c={signal:AbortSignal.timeout(4e3),...r??{}},d=(0,n.request)(e,c,(e=>(0,o.pipeline)([e,a((t=>i({status:e.statusCode,headers:e.headers,data:t})))],u)));function u(e){e&&(d.destroy(e),s(e))}d.on("error",u),d.end(t)}))};const a=e=>{const t=[];return new o.Writable({write:(e,r,n)=>{try{t.push(e),n()}catch(e){n(e)}},final:r=>{try{e(Buffer.concat(t)),r()}catch(e){r(e)}}})}},3249:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fetchUrl=t.ensureValidRedirectPath=t.generateSecret=t.RequiresConfirmationError=t.timestampInSeconds=t.sign=t.urlSafe=t.createErrorHtml=t.httpPostToIDPWithRetry=t.generateCookieHeaders=t.extractAndParseCookies=t.getCookieNames=t.asCloudFrontHeaders=t.getCompleteConfig=t.getConfigWithHeaders=t.getConfig=void 0;const o=r(6113),a=r(7147),i=r(5687),s=r(5687),c=r(2781),d=r(3837),u=r(6489),l=n(r(763)),p=r(4443);var f;!function(e){e[e.none=0]="none",e[e.error=10]="error",e[e.warn=20]="warn",e[e.info=30]="info",e[e.debug=40]="debug"}(f||(f={}));class h{constructor(e){this.logLevel=e}format(e,t=10){return e.map((e=>(0,d.formatWithOptions)({depth:t},e))).join(" ")}info(...e){this.logLevel>=f.info&&console.log(this.format(e))}warn(...e){this.logLevel>=f.warn&&console.warn(this.format(e))}error(...e){this.logLevel>=f.error&&console.error(this.format(e))}debug(...e){this.logLevel>=f.debug&&console.trace(this.format(e))}}function y(){const e=JSON.parse((0,a.readFileSync)(`${__dirname}/configuration.json`).toString("utf8"));return{logger:new h(f[e.logLevel]),...e}}function g(){const e=y();if(!function(e){return void 0!==e.httpHeaders}(e))throw new Error("Incomplete config in configuration.json");return{cloudFrontHeaders:w(e.httpHeaders),...e}}function w(e){return e?Object.entries(e).reduce(((e,[t,r])=>Object.assign(e,{[t.toLowerCase()]:[{key:t,value:r}]})),{}):{}}function m(e,t){const r=`idp.${e}`;return{lastUserKey:`${r}.LastAuthUser`,scopeKey:`${r}.tokenScopesString`,idTokenKey:`${r}.idToken`,idToken2Key:t,accessTokenKey:`${r}.accessToken`,refreshTokenKey:`${r}.refreshToken`}}function v(e){const t={};let r;return r=m(e.clientId,e.idTokenCookieName),Object.assign(t,{[r.scopeKey]:`${e.oauthScopes.join(" ")}; ${e.cookieSettings.accessToken}`}),t[r.accessTokenKey]=`${e.tokens.access}; ${e.cookieSettings.accessToken}`,e.tokens.id&&(t[r.idTokenKey]=`${e.tokens.id}; ${e.cookieSettings.idToken}`,t[r.idToken2Key]=`${e.tokens.id}; ${e.cookieSettings.idToken}`),e.tokens.refresh&&(t[r.refreshTokenKey]=`${e.tokens.refresh}; ${e.cookieSettings.refreshToken}`),"signOut"===e.event&&Object.keys(t).forEach((e=>t[e]=S(t[e]))),["spa-auth-edge-nonce","spa-auth-edge-nonce-hmac","spa-auth-edge-pkce"].forEach((r=>{t[r]=S(`;${e.cookieSettings.nonce}`)})),Object.entries({...t}).map((([e,t])=>({key:"set-cookie",value:`${e}=${t}`})))}function S(e=""){const t=e.split(";").map((e=>e.trim())).filter((e=>!e.toLowerCase().startsWith("max-age"))).filter((e=>!e.toLowerCase().startsWith("expires"))),r=`Expires=${new Date(0).toUTCString()}`,[,...n]=t;return["",...n,r].join("; ")}t.getConfig=y,t.getConfigWithHeaders=g,t.getCompleteConfig=function(){const e=g(),t=(e.redirectPathAuthRefresh,{idToken:"Path=/; Secure; SameSite=Lax",accessToken:"Path=/; Secure; HttpOnly; SameSite=Lax",refreshToken:"Path=/; Secure; HttpOnly; SameSite=Lax",nonce:"Path=/; Secure; HttpOnly; SameSite=Lax"}),r=e.cookieSettings?Object.fromEntries(Object.entries({...t,...e.cookieSettings}).map((([e,r])=>[e,r||t[e]]))):t;return{...{secretAllowedCharacters:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",pkceLength:43,nonceLength:16,nonceMaxAge:r?.nonce&&parseInt((0,u.parse)(r.nonce.toLowerCase())["max-age"])||86400},...e,cookieSettings:r}},t.asCloudFrontHeaders=w,t.getCookieNames=m,t.extractAndParseCookies=function(e,t,r){const n=function(e){return e.cookie?e.cookie.reduce(((e,t)=>Object.assign(e,(0,u.parse)(t.value))),{}):{}}(e);if(!n)return{};let o;return o=m(t,r),{tokenUserName:n[o.lastUserKey],idToken:n[o.idTokenKey],idToken2:n[o.idToken2Key],accessToken:n[o.accessTokenKey],refreshToken:n[o.refreshTokenKey],scopes:n[o.scopeKey],nonce:n["spa-auth-edge-nonce"],nonceHmac:n["spa-auth-edge-nonce-hmac"],pkce:n["spa-auth-edge-pkce"]}},t.generateCookieHeaders={signIn:e=>v({...e,event:"signIn"}),refresh:e=>v({...e,event:"refresh"}),signOut:e=>v({...e,event:"signOut"})};const E=new i.Agent({keepAlive:!0});t.httpPostToIDPWithRetry=async function(e,t,r,n,o){let a=0;for(;;){++a;try{return await(0,p.fetch)(e,t,{agent:E,...r,method:o}).then((e=>{if(200!==e.status)throw new Error(`Status is ${e.status}, expected 200`);if(!e.headers["content-type"]?.startsWith("application/json"))throw new Error(`Content-Type is ${e.headers["content-type"]}, expected application/json`);return{...e,data:JSON.parse(e.data.toString())}}))}catch(t){if(n.debug(`HTTP ${o} to ${e} failed (attempt ${a}):`),n.debug(t),a>=5)throw n.error(`No success after ${a} attempts, seizing further attempts`),t;a>=2&&(n.debug(`Doing exponential backoff with jitter, before attempting HTTP ${o} again ...`),await new Promise((e=>setTimeout(e,25*(Math.pow(2,a)+Math.random()*a)))),n.debug(`Done waiting, will try HTTP ${o} again now`))}}},t.createErrorHtml=function(e){const t={...e,region:process.env.AWS_REGION};return l.default.replace(/\${([^}]*)}/g,((e,r)=>function(e){if("string"!=typeof e)return;return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}(t[r])??""))},t.urlSafe={stringify:e=>e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),parse:e=>e.replace(/-/g,"+").replace(/_/g,"/")},t.sign=function(e,r,n){const a=(0,o.createHmac)("sha256",r).update(e).digest("base64").slice(0,n);return t.urlSafe.stringify(a)},t.timestampInSeconds=function(){return Date.now()/1e3|0};class b extends Error{}t.RequiresConfirmationError=b,t.generateSecret=function(e,t){return[...new Array(t)].map((()=>e[(0,o.randomInt)(0,e.length)])).join("")},t.ensureValidRedirectPath=function(e){return"string"!=typeof e?"/":e.startsWith("/")?e:`/${e}`},t.fetchUrl=async function(e){return new Promise(((t,r)=>{const n=(0,s.request)(e,(e=>(0,c.pipeline)([e,_(t)],o)));function o(e){e&&(n.destroy(e),r(e))}n.on("error",o),n.end()}))};const _=e=>{const t=[];return new c.Writable({write:(e,r,n)=>{try{t.push(e),n()}catch(e){n(e)}},final:r=>{try{e(Buffer.concat(t)),r()}catch(e){r(e)}}})}},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},3477:e=>{e.exports=require("querystring")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n=r(8381),o=exports;for(var a in n)o[a]=n[a];n.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();